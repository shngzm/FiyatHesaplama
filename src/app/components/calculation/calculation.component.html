<div class="calculation-container">
  <div class="calculation-card">
    <h2>Gram ve Fiyat Hesaplama</h2>
    
    <!-- Gold Price Info -->
    <div *ngIf="goldPrice" class="gold-price-info">
      <div class="price-header">
        <span class="price-label">ðŸ’° AltÄ±n Kuru:</span>
        <span class="price-value">{{ formatPrice(goldPrice.selling) }}/gram</span>
      </div>
    </div>
    
    <form [formGroup]="calculationForm" (ngSubmit)="calculate()" class="calculation-form">
      <div class="form-group">
        <label for="model">Model</label>
        <select id="model" formControlName="modelId" class="form-control">
          <option value="">SeÃ§iniz</option>
          <option *ngFor="let model of models" [value]="model.id">{{ model.modelTipi }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="ayar">Ayar</label>
        <select id="ayar" formControlName="ayar" class="form-control" [disabled]="ayars.length === 0">
          <option value="">SeÃ§iniz</option>
          <option *ngFor="let ayar of ayars" [value]="ayar">{{ ayar }} ayar</option>
        </select>
      </div>

      <div class="form-group">
        <label for="sira">SÄ±ra</label>
        <select id="sira" formControlName="sira" class="form-control" [disabled]="siras.length === 0">
          <option value="">SeÃ§iniz</option>
          <option *ngFor="let sira of siras" [value]="sira">{{ sira }}</option>
        </select>
      </div>

      <div class="form-group">
        <label for="uzunluk">Uzunluk (cm)</label>
        <input 
          type="number" 
          id="uzunluk" 
          formControlName="uzunluk" 
          class="form-control" 
          placeholder="UzunluÄŸu giriniz (cm)"
          min="1"
          step="0.1"
        />
      </div>

      <div class="button-group">
        <button type="submit" class="btn btn-primary" [disabled]="!canCalculate || isLoadingPrice">
          {{ isLoadingPrice ? 'HesaplanÄ±yor...' : 'Fiyat Hesapla' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="reset()">
          Yeni Hesaplama
        </button>
      </div>
    </form>

    <div *ngIf="result" class="result-card">
      <h3>SonuÃ§</h3>
      <div class="result-summary">
        <div class="result-item">
          <span class="result-label">AÄŸÄ±rlÄ±k:</span>
          <span class="result-value">{{ result.gram }} gram</span>
        </div>
      </div>

      <!-- SatÄ±ÅŸ FiyatÄ± DetayÄ± -->
      <div *ngIf="result.fiyat" class="bozma-fiyati-section">
        <h4>SatÄ±ÅŸ FiyatÄ±</h4>
        <div class="bozma-table" style="display: flex; flex-wrap: wrap;">
          <div class="bozma-row">
            <span class="bozma-label">ÃœrÃ¼n GramÄ±:</span>
            <span class="bozma-value">{{ result.gram }} g</span>
          </div>
          <div class="bozma-row">
            <span class="bozma-label">Ayar:</span>
            <span class="bozma-value">{{ result.ayarKatsayisi || 0 }} ({{ calculationForm.get('ayar')?.value }})</span>
          </div>
          <div class="bozma-row" *ngIf="result.iscilik !== undefined">
            <span class="bozma-label">Ä°ÅŸÃ§ilik:</span>
            <span class="bozma-value">{{ result.iscilik / 1000 | number:'1.3-3' }}</span>
          </div>
          <div class="bozma-row" *ngIf="result.iscilik !== undefined">
            <span class="bozma-label">Toplam:</span>
            <span class="bozma-value">{{ (result.ayarKatsayisi || 0) + (result.iscilik / 1000) | number:'1.3-3' }}</span>
          </div>
          <div class="bozma-row">
            <span class="bozma-label">AltÄ±n Kuru:</span>
            <span class="bozma-value">{{ formatPrice(result.altinKuru || 0) }}/g</span>
          </div>
          <div class="bozma-row bozma-total">
            <span class="bozma-label">SatÄ±ÅŸ FiyatÄ±:</span>
            <span class="bozma-value price">{{ formatPrice(result.fiyat) }}</span>
          </div>
        </div>
      </div>

      <!-- Bozma FiyatÄ± Table -->
      <div *ngIf="result.bozmaFiyati" class="bozma-fiyati-section">
        <h4>Bozma FiyatÄ±</h4>
        <div class="bozma-table" style="display: flex; flex-wrap: wrap;">
          <div class="bozma-row">
            <span class="bozma-label">ÃœrÃ¼n GramÄ±:</span>
            <span class="bozma-value">{{ result.gram }} g</span>
          </div>
          <div class="bozma-row">
            <span class="bozma-label">Ayar:</span>
            <span class="bozma-value">{{ result.ayarKatsayisi || 0 }} ({{ calculationForm.get('ayar')?.value }})</span>
          </div>
          <div class="bozma-row">
            <span class="bozma-label">AlÄ±ÅŸ Kuru:</span>
            <span class="bozma-value">{{ formatPrice(result.altinAlisKuru || 0) }}/g</span>
          </div>
          <div class="bozma-row bozma-total">
            <span class="bozma-label">Bozma FiyatÄ±:</span>
            <span class="bozma-value price">{{ formatPrice(result.bozmaFiyati) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="history-card" *ngIf="history.length > 0">
    <h3>Son Hesaplamalar</h3>
    <table class="history-table">
      <thead>
        <tr>
          <th>Model</th>
          <th>Ayar</th>
          <th>SÄ±ra</th>
          <th>Uzunluk</th>
          <th>Gram</th>
          <th>Fiyat</th>
          <th>Tarih</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of history">
          <td>{{ item.modelTipi }}</td>
          <td>{{ item.ayar }}</td>
          <td>{{ item.sira || '-' }}</td>
          <td>{{ item.uzunluk ? (item.uzunluk + ' cm') : '-' }}</td>
          <td>{{ item.sonuc }} g</td>
          <td>
            <span *ngIf="item.fiyat; else noPrice">{{ formatPrice(item.fiyat) }}</span>
            <ng-template #noPrice>-</ng-template>
          </td>
          <td>{{ formatDate(item.calculatedAt) }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
