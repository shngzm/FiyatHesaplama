<div class="customer-management">
  <div class="container">
    <h1>Müşteri Yönetimi</h1>

    <!-- Customer Form -->
    <div class="customer-form-card">
      <h2>{{ isEditing ? 'Müşteri Düzenle' : 'Yeni Müşteri Ekle' }}</h2>
      
      <form [formGroup]="customerForm" (ngSubmit)="onSubmit()">
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">Ad *</label>
            <input
              id="firstName"
              type="text"
              formControlName="firstName"
              [class.error]="customerForm.get('firstName')?.invalid && customerForm.get('firstName')?.touched"
            />
            <div class="error-message" *ngIf="customerForm.get('firstName')?.invalid && customerForm.get('firstName')?.touched">
              Ad en az 2 karakter olmalıdır
            </div>
          </div>

          <div class="form-group">
            <label for="lastName">Soyad *</label>
            <input
              id="lastName"
              type="text"
              formControlName="lastName"
              [class.error]="customerForm.get('lastName')?.invalid && customerForm.get('lastName')?.touched"
            />
            <div class="error-message" *ngIf="customerForm.get('lastName')?.invalid && customerForm.get('lastName')?.touched">
              Soyad en az 2 karakter olmalıdır
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="phone">Telefon *</label>
            <input
              id="phone"
              type="tel"
              formControlName="phone"
              placeholder="05XX XXX XX XX"
              [class.error]="customerForm.get('phone')?.invalid && customerForm.get('phone')?.touched"
            />
            <div class="error-message" *ngIf="customerForm.get('phone')?.invalid && customerForm.get('phone')?.touched">
              Geçerli bir telefon numarası giriniz
            </div>
          </div>

          <div class="form-group">
            <label for="email">E-posta</label>
            <input
              id="email"
              type="email"
              formControlName="email"
              [class.error]="customerForm.get('email')?.invalid && customerForm.get('email')?.touched"
            />
            <div class="error-message" *ngIf="customerForm.get('email')?.invalid && customerForm.get('email')?.touched">
              Geçerli bir e-posta adresi giriniz
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Bizi Nasıl Buldunuz?</label>
          <div class="checkbox-group">
            <label *ngFor="let option of howDidYouFindUsOptions" class="checkbox-label">
              <input
                type="checkbox"
                [checked]="isChecked(option)"
                (change)="onCheckboxChange(option, $event)"
              />
              {{ option }}
            </label>
          </div>
          
          <input
            *ngIf="showOtherField()"
            type="text"
            formControlName="howDidYouFindUsOther"
            placeholder="Lütfen belirtiniz..."
            class="other-input"
          />
        </div>

        <div class="form-group">
          <label for="notes">Notlar</label>
          <textarea
            id="notes"
            formControlName="notes"
            rows="3"
            placeholder="Müşteri hakkında notlar..."
          ></textarea>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="isLoading">
            {{ isEditing ? 'Güncelle' : 'Kaydet' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelEdit()" *ngIf="isEditing">
            İptal
          </button>
        </div>
      </form>
    </div>

    <!-- Search -->
    <div class="search-section">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        placeholder="Müşteri ara (ad, soyad, telefon)..."
        class="search-input"
      />
    </div>

    <!-- Customers List -->
    <div class="customers-list">
      <h2>Müşteriler ({{ customers.length }})</h2>

      <div *ngIf="isLoading" class="loading">Yükleniyor...</div>

      <div *ngIf="!isLoading && customers.length === 0" class="no-data">
        Henüz müşteri bulunmamaktadır.
      </div>

      <div *ngIf="!isLoading && customers.length > 0" class="customers-table">
        <table>
          <thead>
            <tr>
              <th>Ad Soyad</th>
              <th>Telefon</th>
              <th>E-posta</th>
              <th>Bizi Nasıl Buldu</th>
              <th>Eklenme Tarihi</th>
              <th>İşlemler</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let customer of customers">
              <td>{{ customer.firstName }} {{ customer.lastName }}</td>
              <td>{{ formatPhoneNumber(customer.phone) }}</td>
              <td>{{ customer.email || '-' }}</td>
              <td>
                <span class="badge" *ngFor="let source of customer.howDidYouFindUs">
                  {{ source }}
                </span>
                <span *ngIf="customer.howDidYouFindUsOther" class="badge badge-secondary">
                  {{ customer.howDidYouFindUsOther }}
                </span>
              </td>
              <td>{{ customer.createdAt | date: 'dd/MM/yyyy HH:mm' }}</td>
              <td class="actions">
                <button class="btn btn-sm btn-edit" (click)="editCustomer(customer)">
                  Düzenle
                </button>
                <button class="btn btn-sm btn-delete" (click)="deleteCustomer(customer)">
                  Sil
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
